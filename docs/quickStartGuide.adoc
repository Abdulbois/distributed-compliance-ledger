== Disctributed Compliance Ledger (DCL)

=== Quick Start Guide for CLI for testnet
This guide will help you configure DCL `dclcli` and interact with DCL TestNet.

=== Test Net Infrastructure
TestNet consists of following nodes:<ID>@IP:port are to be used with `dclcli`.

. tcp://54.73.187.91:26657
. tcp://3.124.76.30:26657
. tcp://34.224.48.142:26657
. tcp://44.239.5.82:26657

=== dclcli setup
These steps will configure `dclcli` on Ubuntu platform.

==== GOLANG 1.3+
Make sure you have goLang 1.3+ installed.
Ubuntu
    https://khongwooilee.medium.com/how-to-update-the-go-version-6065f5c8c3ec
MacOS
    https://www.jajaldoang.com/post/how-to-update-golang

==== Download Pre Compiled `dclcli`
A pre-built version of DCLCLI for Ubuntu: https://github.com/zigbee-alliance/distributed-compliance-ledger/releases/download/v0.4/dclcli, so no need to clone the repo and run make at all.

==== Download DCL Source Code from repo
.DCL CLI Build
[source,bash]
----
$ git clone https://github.com/zigbee-alliance/distributed-compliance-ledger.git
$ cd distributed-compliance-ledger
$ make install
----

After successful comletion of above steps, `dclcli` should be installed.

.DCL CLI Test
[source,bash]
----
$ ls -l ~/go/bin/dclcli
$ dclcli

DcLedger Client

Usage:
  dclcli [command]

Available Commands:
  status                   Query remote node for status
  tendermint-validator-set Get the full tendermint validator set at given height
  config                   Create or query an application CLI configuration file
  query                    Querying subcommands
  tx                       Transactions subcommands
                           
  rest-server              Start LCD (light-client daemon), a local REST server
                           
  keys                     Add or view local private keys
                           
  version                  Print the app version
  help                     Help about any command

Flags:
      --broadcast-mode string   Transaction broadcast mode to use (block, sync, async) (default "block")
      --chain-id string         Chain ID of tendermint node
  -e, --encoding string         Binary encoding (hex|b64|btc) (default "hex")
  -h, --help                    help for dclcli
      --home string             directory for config and data (default "/home/ahaque201/.dclcli")
  -o, --output string           Output format (text|json) (default "text")
      --trace                   print out full stack trace on errors

Use "dclcli [command] --help" for more information about a command.
----

.DCL CLI Configure
[source,bash]
----
# Configure `dclci` to connect to one of the testnet nodes
$ dclcli config chain-id testnet
$ dclcli config output json
$ dclcli config indent true
# dclcli connects to a single node. Set following property to ensure every reply from node is 
# cryptographically verified.
$ dclcli config trust-node false
$ dclcli config node tcp://54.73.187.91:26657

# Run `dclci` to connect to one of the testnet nodes
$ dclcli query modelinfo model --vid=500 --pid=504
----

==== Create Vendor Account Steps
.DCL CLI Steps
[source,bash]
----
# First create vendor account. Remember the password and mnemonic below.
# mnemonic can be used to recover your key, therefore it is important
# to safeguard it
$ dclcli keys add <vendor-name>
`Enter a passphrase to encrypt your key to disk:
Repeat the passphrase:
{
  "name": "cool-vendor",
  "type": "local",
  "address": "cosmos1pkxl6k9r4r5ng9k6upp3e4f2wt2putq652w693",
  "pubkey": "cosmospub1addwnpepq0tgh3uxwas2n2rky2ulmqza269mkxvwzq63t69ay7xpsc83q888gngalmn",
  "mnemonic": "mandate rally glue ugly next erode link clarify disease adjust relief runway better rack saddle page sight fly vital ribbon captain dinner dish edit"
}
`
# Send your `address` and `pubkey` to Zigbee Alliance to be enrolled in DCL.
# Zigbee Alliance will propose your account to DCL
$ dclcli tx auth propose-add-account \ --address=cosmos1pkxl6k9r4r5ng9k6upp3e4f2wt2putq652w693 \ --pubkey=cosmospub1addwnpepq0tgh3uxwas2n2rky2ulmqza269mkxvwzq63t69ay7xpsc83q888gngalmn \ --roles=Vendor --from=<Zigbee Aliance Account>

# 2/3rd DCL Trustees will need to approve using following txn.
$ dclcli tx auth approve-add-account \
--address=cosmos1pkxl6k9r4r5ng9k6upp3e4f2wt2putq652w693 --from=<trustee-account>

# After account approval, you can submit your product information
$ dclcli tx modelinfo add-model --vid=12345 --pid=675463 --name="Disco Ball" \
--description="CHIP Discoball" --sku=A1234GH --firmware-version=1.0 \
 --hardware-version=1.0 --tis-or-trp-testing-completed=yes \
 --from=cool-vendor
 
----